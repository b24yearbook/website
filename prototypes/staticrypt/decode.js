async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
    const encryptedHMAC = signedMsg.substring(0, 64);
    const encryptedMsg = signedMsg.substring(64);
    const decryptedHMAC = await exports.signMessage(hashedPassword, encryptedMsg);

    if (decryptedHMAC !== encryptedHMAC) {
        // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
        // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
        originalPassword = originalPassword || hashedPassword;
        if (backwardCompatibleAttempt === 0) {
            const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

            return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
        }
        if (backwardCompatibleAttempt === 1) {
            let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
            updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

            return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
        }

        return { success: false, message: "Signature mismatch" };
    }

    return {
        success: true,
        decoded: await exports.decrypt(encryptedMsg, hashedPassword),
    };
}

function testDecode() {
    return decode("d025aa2eb708f75469f92333a7743cb4e9ba843c592b8fae1e5e190eac95644fb2a3b0cd66a0d4c0845e44cae319a2a8ef53cf708bd6e468021b0f98b292bc19676141664cf2600eb57f2ba16259af3212b883e06c69ae165fcd97e7bd2f052a88d7150b6ed3deb27f39b385a20c2112c7ed9d40e21949ecb2d4df5b1dda7a23d6f76fd0262c4fd9db09c0a26159de6d1f3f0809a768a9b842d9b46b1f4ba42a7b770f6deb2098ae70ae4806178a5f40202327a800d509a6e82e95013f2ba9a635974edeeb2ad10a90abd0658e704917e7b6b5eb9680c78825fcb38a7983731fb42351fc4fb039046f96bd6f51dae2a2f8a0d769d2ff638bb70c6397584498a7ec03a66c45de54369480f7e5aca254991bd1b2cf521b7fff1880aa967c056f8813ebf758f1e69464264cdff1a38f39b312e792065168d3032fffd86851faf767215cc515312c313e87541b5b9305735b8715637550c7ec1282151c7f5426e62ad5f85ecb20fa767eead56cb88be27ac6877f9684ac27907835778c6bb4c7201c67c4bbb8619bf194a6db32991f41aa5b4a4a022cdf9015b6d310677ca7597f81b45a69c6e2777f7735a46cd3f9169b13b706a25b117347d40492cb59f6110a1526575c4a03b2a5506e4b1f92a7f00fb43354e4ebc02fee30cf046c849157145e1510221807612da55fe00890000763c51e67a8e1228dde4ecc20cef46ee5e71037a6afd06eb3bdb2403c7fa21ccb673dcc3485eef80c9f7907ec775bec9297498affa321bce003cd3d96add6c45593e7cc3d0eddb42b18b3e79b419de70d0abef1355239963326669821dfc2bf78584b8bafa109e1d71f13a9d8aa26966f84515904aeadfd9ac8492c0b2dc2f1aaf7bd480f040718e7190dd3cb0163b2a336cb3b60608e09ca1c670a042179f8c2132970b3d7105fccc46a0cf29c2e6294fe6a4f4461bb1ed68d6cb3e11c600ad96d75b7d12340cdf93cdabc16b0e7395103adb9b6cebdad1adb805578963706cfdc4c4184c7577a9f178407f4456cd726927a1ba64ebca152b05c67f8fd83579cbebb1a1d261fbc5dc3301b861e468d9fa5b1d1e96a1531835173699145c4a10a879326d6f803e620ffade7e35e971194ca567ce1bb228088394eaf5257afa63379069e358ff7b0adfb8f6c6202087ba4effb8967eb27008b6e6b254f1876876c6415e79594a906555385ca5c9c26f058949d3357690d3498c4dadadbb65cd9c726a86c9464c8296f69cbdc0adec33548c900d634911e024759eefc8ba801b5629c1b6c9786316fdf991b0acf4c263aca3c6161c95a05ed84dba1b0a8ec2449ca42ac8c1ce2461a27cd0d1de36ef69b517153aa312ca565cc068a7cf248bf36d9445de747e0f6c1a6d7b935293b807e1369b0488387d0506d0ba14d293bb986f8b64ae1a2c9738c4b4fc2a855d2ef3f981ce652bf668899b4a9c1ae776d76961121eb8d8ef9a90780b8b161b0bed6b973ab11dd71d8cbc4a47f8dd721a86919da9cd251c2e66b0b71cd644b882d527974baf7f2ee790a97658500b3ca57265a37c4bbb13349a3d487d4cb6b484748cb9ab3c2647d70a90d8c503f35fee5c1dc54920b61bb707a910bf53a9420f801a079c2a0a28741b9fa3895ca54d8f86731ace56388cdb3beb0e56371c60b7825fcb9250072614373b547e77cf4fb21d33c62cfbb6d077997dc3fc336104f74ba7191334b8e659be3c4ca6f03587da34928b56a747059664da17d50695b86e48dc96ce62654c271dc5124cd926b85dd2d3f019c590ae0a9c8e9e8516f5793d47db169c799be37c3e33b106fa758d2a105b3350a3e62953c17fc2e32808dc67a7851967932adb296651c2442626cc6612cafbbc7470c33234aa542a09722964ff461c5b3c802954d03bd86983f95c8a31940680d9f29390c4454b4214467847a1507b3693aadef5926404558d5229ed21f0dc13089ecd3b41409c7432b52eb80108e01f8fe0f1a911d37954b98b45b579d1f7746d4390a02601f5609703de068c5ab29ab81152f2d54d004d14db49f4c83dd45da9a37c673efe6384f755b6d70dc88265828bbc20e24b624e6583f067e715bcd253dbad8d6d616df2207a7a67312560eeb1ccaeeae1a1e02a679e8ce12327641c5f7ec66e1cd17c962471c98788558a3de8e4e960c231df5892341b5c6ebbd210b265d0f61bd95d1fefc98b34a4bc8e9789a0a716e812fa1f7c3ab08931f29c40f1e76ef2edbc9ab694ec50b32f15954770f66b49f8733100019bfa9bbe75fb2268a2b440ba291e6347e9f169f6782ed16ced39c6800b731cd898f1ed45e955f2439f365e153f12ac9602de69aadb46378769a6f44661723dac72872711bacf17730977f8ffaf9e933906e65a2734a87c83096aa54892e3d17853957868790d9d618ad03d8e662d379efea816db1888872976bf685285dee0709343b6534b813bebbe1c0561ba3d93afadd7fa0dea3ee48e28f2c0b876324b93dc7f8fc944238b931851b9a45d701b9f74020b20ae479d950804964eba48157c1849f59459f15ae692d44ec01ef096e828e50abe3847739fb59fa982ace22e5acf393552c215720246d384b43d44a96a545d491f9614f69e738a08e896cbc5c66fd3d5e851e32c3bc74b89233968584bf211deb16be9e7951877491969c88848954375f5ee76e6673d3d945b585c8abb0d5496d4af21200401cbdd15224913a66378f6aeeea29071311509684e6dea452deb6c2112a1588e30f9dcfaa498808d93c6b9791082d7ea34b3e208a7954ca92840aaa3f3e904b5a4e79a821094bd56a4d4154820916ef03be3f71fae6887d286b2d957a2989c20c72328c0e0f610d81c7b98843687df7d908012fb9316db8b16a95b0d42dab5244f7bfa316589722b733159ce16ed8cf837619dfc671e413de35240a14a6c08c4409cb370a75aaa081bee1be7ec63fa096a53047a561f1d07d3182136b0e5791d57e32a7a4403b4e94774fde33847c951ef4ca2187666c6180638926a73c83da8a9afe0cf5f7be2669f652144e87807071c8a9c057c97eb2d56a36fb862732b434c220e4ca00969b25f6c61c078e8dffda7d986edb9e02e81ec70b588ac8e1a4ae4455a4f3a3663b863e17b1f5f7e84e465eab7f9a19eaadd60ffcd0b8b76874caf72ebd9df4abef9ff9151892f7c17b74302202ffbc2455c24a0cf3903ff5346fdb7fc0cc060f18ead5e1d576aa3537b167567f6ce1b3f959e073345461838a7c7e689ad6f478c25e0a25174f1efb4597736bf8a62af1e0e491600fc341a631d89b05c293e1d2aaf13eb3d31023f70ad868b4c2f127e88f18b1d14a9167afe477cfb45e32cea39181e179174db187c64ae28464c738fead4e33b21354c2862bbca289123edba1124b0b5163da447114acb27a4371c84f5b8287752a6e51a3ac7a9ab10556283c3cd0e824b99f39ff077f3eb75e9a070b5869e0d8b3d2b989091d61d7fb454d44792a2df5a904563fc1e0e42c0cf874c5ff503b00fd5f5b1fe74de0a4019a8f0e8bf717f224b77368046b20f063582edad39a1b683f79d2638f7ba5cd2433e5f73a1f29464538728a82532bea234f008a682a5b09814b17d287aa36ce8378b1321d10cf40ffa259869e47dc215b5f482ffcedc6fe338e32d6e19b8a6342e636e511716adf34a0539fda24481c325f665759e242151ff5fdd607d245acbb6e1214a3c496b1ee8401dd5fe44deeb638566dea3d3593a728598d8c5fe68b0e9c5ee52c6072efa145993b7aa8dc8d4150578c4a133021142b05a0b58d1847cc2561934baac59ddf0ecc2a424335fbdfb0651d9919db889bf786451282197f5d9fbe36facd485b222eb7cc8cf808b5f7a986f0982f5ce17549915724f38d8c808ae8c3db9aa5972f2ac8aacb8f505535e531eeeb51ec58c5ca35355250d991f8c7a3522e7fe00c5ca7c9459e0d737a7d5c3dddac1f95c24c4f7a8446bb1666a92b627440f91b3ce71489c1552188f0fbdeb6fd8da1672e807de84f4fd23a4e8b4473d2ab5ba7af794307cec5da600ff8f34a51582e7ea8fc3d601dcdfe29818f4bbc38909dc106e652ce34fd3f92e0dfacb4f830b6f8a9a110ad80af262c9c6513758b63e14d5817031d68664db3445750919e74f3692bc37fc3ff015a5ddc4f9171832d2931a27025f9e61338803a1404b7b598ef3993a17cbf96b25efdd08315825adb8544d6d3efa5960dc52355a4c880846837f505f7410088dbbbb1e3872639d4118c37a0888ad7c5933e60f642aded19f46c73b082945ae02b94438f57e5e7f4fbad24e18eba92b16ad1d189ced7a974c826738ab0b13a4732680f0377269f0d106ef87d7bd05d7a1123019ce0eda8462d60ea9b3e50d5553b15c5e1d788548c1b4a484911b2bcef98c2b388360368e7bac8fda50317766c80122a4f268348216639d6217050b9188c5f1d86610ae21893c66a248449014bf77465a3a7fd9066173c9539634cb894b0e1b6bc9773855579c9383554f1883b6fd1b33253befa9e62540878c3f0a6bd45b36b1f1704929ad962f731cc358137118e162979c7c2756c11888cf59f54334b006147e39976c1972bdb4dc066e5f1a83a42a4a455917d27b01010ba84ba4c9948204c9adb6e895a3a800d9d8a7b0dfab18f1fb57cb53df50662ce0e9de25a63bacb3dd59997e0293b7074b031275a40485ea72373786a60b20f3bede88858d0fe1d418f6331d68e868fb3ccd17a6c4e89372de0b4e9dddd836beeb923a654ffd0c781963c6dec6d84a41ca98ea9695c0ca824f37911ac38cf9624dcd580e6c6572fb6a561e2f6f9304c868e67c11d331cc23c0ff2c5c9867142c37bbe7b026a7dc9982f8290e50db2481e3aca81b6b75545381df89735de8371cb13239b08fcc743078513f90ae683ca8f45e83f87addb6b1c6a2b6d93e334c02355a4ad695ec27b1e459fec27fb7ef1618612bfbc226b41e2b06fb42f9cde1e65589473e2a7f352126e52441ac852b8ae4fd443a7bc6e720702a8d1d777646f1ab01cf4dca37e27db845471659d9a1c50beb2d52e86f319162b0efaa13f3d956629199e026fa6a0a8f06d5a0651aca2f722df4f32e88ff8023c1ee2f1a3aeff721da300497b5b5a4cc8c6e9bff26158359d92fec7abd391acba95f29651d334e6674574948cf9b32383099597d7b6646ba24cc0b8f4870fbde518caf72bbdb2b903e358873b3cc9139c31f11f147d1c78f07bbd42a21de17299fecb3ca0056da84cefcfd7a84b62d5a49667b671b692c7193ae46426bbf7cc00641e48281f0eb067b3bae17eb1373bc73f89203ebe13f26207fa2f8687949bd415a144da676066d1cc345fb6306624943bac87c5ca59b76ba36c1a56ebeb048a1c487db1fe51505982e3812ee10791080b7921db2bd23f96fa4b7f6e8332b8d08445e733d7ffb716abe85b67cfec876246584f70e67c0c18dfc8e523775797a11836cfa13bb6e1cc33d94a533b0f70a49e6a6c1625a1ef264e5b272d80fc9d5926e27677ce98cc92e6db6968b02d89d615cd9046c47552dfb7fb2da8c0fef350a4f57ff8d22d5f6c5d287c6bca042bfcca364b0be5df5fa2944137b4fc78c09fc94e5031c883176c97d95d9204904d8eeab618891d55e2d5e4e5b93cdb7000a3e73758e39757c841872599b096145760895a9a6d375218dc39322fb497905d323aa1be63687264b468ca4d4383417c43653dbdc5ab96808e31487b51f371a18db67d7d6965d9c249cb9dc2f64f06046089303f3e00cd35546aa7866a38ed8293b412569459c8f107b68a00970a85eff4faec3bed6bfb5b22f607e8f0bbc72d75fa1cb16acd60ae5fd3373793a34caa57c4fb7ba75dc3cebbf06a5625bdd7d6f4a90f54fc9750daf36c44fcc1857aab4d670da90b7d0a603d7bb2a4c7c76b7d2fb256f1bd07940482466b15c543dc86f9221cb3f7c8e6b33deb88e4f434af7aece3fdbf57ba2ad4ea38afdfcc1e9948253ff4286dfe8486ac66e72e5dc88a3c53133f068708f177de90f2dd6abf9447fad4c55b103e434aee6bbb30c3a0d61cf2d3d469f52b664c8e62bc0f78a9896088fc94deb944027f28f0f9eab6652292fd76201617e64704c0ffa930f701d36f290a8486104b69535b1c25b5809e85e43f0457572572516a43ae51cede897d4fb6fa0ea0137b629f8a8558eb852fc5e2c233ae3a74c9871ec25ad9bde9479567620ba90f9ad09818692d06f99a494f67969c70f5896751ede03155c289012a7a0eb202923e89ebab022dd627ac6b36f98081bbce8edbbaf008b4fdf17be4e2aa354dcb6269462241c1dee0292a673d60f9d4ac8685994b76de4a1572ce16f58b48996c1c01bdd739178002a414da1376d166243e386424667705eb031ffe9082c33e069bc6cfe78e031276e00f643ef32fa0091f30eb15c18b27c40588015bd6a673142fdebbafdd3a18d0109d24b48d95234db29e6a0f27feeb63ecd2f5f3754f88e099bcaba8558291666d42ddbf6381d2db368ae1131d9e424e942d7856a983b8eb671ba81c6cc4ce025be52859879d796ee667c8577a512aa2c7bf296d7aec42ba82845cfbbcdb66c32791eb6aedeedbecea42312b963713d66a302a3de8ae99a67f39d57b0c5d39c342a8db1924a5ea83090c0af5181562e73656d54ead8936489e31912e5f127d7412541629d6e5fdea7c7e6367831d915295bdaaecdfd8a86f83f1c814d3aa9a67a16f86bb2550665abd212eed4b9e0a01de158a4fad9e142a500847907070fe269bbdfacd56e07731c749d4a0e785296fdc432937ba90aa500391c3c78c2a9958205a93659f6125e738b8a3e6a58d5b08b850cd4af8d136357c41b80f6a9e490d94f41c46a29f870021302e03982cb705db342424d4fc01e9418b7ba7ad052abb08013b5dd9d0935bae8336625dfe5a9151ce1d69e7bd37441c7aa6fb46805fb953a24f4c43a332e7dcfbb6e2ca87457d489a23f459977d05912a4581e118c9066693406209a004ed96561ce297700fe4233e843f74928f86cff5890cef98568947bc91bed97e2bcc86f2718371193bb24a487e41cc3eac54dfe5c5da32fd02d000cdbfc8970742ebc44924eca49a6eb63399db1682e538093ca28ceb8f5821ee28f55a38383d1b3c41981ea3dd6a35a3c2bb10d4d76f0c7ef77655385dfe7c52f9477024993c6c24328b5f586fe4a5e345ec2b577103b1eb7eb5c19e6405b9b4dcce6a4ba83acade9a12c877dec45f4d5d9ea78038d0bf68cd71ec9aa4c4b642f51125ba17a1e042461ced81e414f568d323e934e60f10f09903f7eeccfe9c5aa5d933b16519d2775d68f7780cf1e2f4cbcd395c1eefbc7fa581ed00f6d944143b9a0064db96f8431b75649b4612ec5a58ec312504d237c2b7ade58137f00f2eab2a6f103929236567b6809b065bac6bb22d5da55c16efc41ca735a74021ebc16aba4329c5de756caea9be3f171cfd3fca9c59ea2f8700b6e5d8113decf2a51239df01857a1fd47d55b8baf59b17ce8c5c6893a3e4cc5f5fd609c29ef2b6147ccb87bd77ea81d454ab7edd5ec3b03ba2f8caffcf3515aeef2572b396a4187396cf8cf22909fb30352cd246237b777a463e1703ddfc10d2043ac9fef95f8df792c38d21978a347a61bde13611b847177b46b86bdf3c48805690e413fd5e352325678d82a7f2609da200c1cde6a3e58c76152024010caa1c0c6c1f6dc8caf108c9ccd34519f85cd1194c377b33249930c6ec21f112aa1f7fdd2cba99d15fed8d273823e203aeaf0b3c1675563daa91b0a341afe41cd851e8c4fb987794aa072d68efc86d3a960ec16921cc3736e63391e4a464f7c1c0839bc97c0acfd2253c92aa22c8772e6058c2373d1acfc940b56710ba5a9c2d7e49c45d36607745d929737cf08b26a40412fe6fbdce41665766353ddaf32803253a0f110991e06c4edd9edc10e26b43cfef3a4b9443c7c5c07e510679804b8b4b2f6518af4ec16a659f49bb9c083b22436bc86ee8474aea6f72e991c6647bf33c65ce21658c4c6b002e95aa6ae576f07dbddbe165b6e8d9baad1a5d8fd04e330c3d04c2077b0841262769d6e464e350fecf0a670d1565e50e06d86ce7d4d29ba4022c74ad8d81fbbafb871ed8db03380ba408181075a6626c36111f01f5e1298129745b1171f992760f5c3e1a29f49be79e152e280b0c42a8f712db09cd2ca384d310f9438bfb234a69960fc16ebcd9d4f14ea9277b2a5dcb938da8eb4e35688346e9a6d231821142d49ab5014a70b8e2d0d216a11cf2148ccf1e828b62cc12a223cb3d9a4f8589a262b642be54f5f7dbf20eb9f3b1179f767829145ca22341a933919cb84e21a7b0337c8ebb9b79eae3548314bb3ab5e508e7f9473624fe0fc3fe0647097942975d7d160ff17fec105bd63d8b67140b527e8d237af6cb4ec094a0d83d212e5990c1e91ff841582f994f74a19ddd030c0817cb5667e5f27eacfc7dcef157539191ce461f84d236b58e5def1bb64b8abf5fa089862ceb4db5f473d7cdade96466bb93b5028765ca57833db4b5655d27328129fd752084cd41006ec73d508908eb8ed723579964fe296025149c1a87b9a9926d9e5997b1cba24b7cf456a9322bbfa7a8ec9fad0eea8257afabb95d1d6539ee2fb35ec46b83130a482c1106f31a9e000f4babb4abb0e07762d498cb18ebac307ae322cc2b449a0521bcc70a208c95282500586dc6ca44c33f3a5451c4df36e6c8c4f250e73d91f8573849a262a9c84fe24ecace54af95710f5fa9db2e62c3d5b0c550ac54fc3be0b55c920e1fc6417b6cec10d0e0a3c3c9140f1df012cb3915367a207ade1b25323e912561f9e31681d4934dabcb0a7956067c776ed5702de136b8aefc2c289266b4e1a81a20d7c2f999b41c69cb80bead0cf775308b5c1540f3fcac6374011c27d2527a98f6b5c5b5203a6cdf39c3e73d0b47540eb7c1f2c6b4a4828cb7a36148a0da96d009601770fc5fff15157a3025f01a0f2fe1bd0bb2e62f621444388bdbe440d2dccad35358cb2d8aec4f2da7951d1fe8ffa0970471b4f6ff60dfaa84fbca3231634408b0590dc8379949314ba56cb50687f583047c9d80597e71c221459e5cc19adfddc74487164fb3ca232aedeb80f764c7cccdefb4348d96592ec1d4edcaf428c781f43947599f001ce10a85b4c508601b6da75ac37f6e906fb424a4c943ed9086496885d08bed824f6d4a5d7328f1a97dbd59342874efca3774c455aeb2973c95ed657367cddbf3566a2e7326fc9f7c74eb1da8ee76df0797ffda7fe3525cda1dfcbe39a618e6545e8d9299bb532340d2826341043d177ce9e904f1c2e4ae34208128e4774327b646f85f5bff89e1355dfa2150151dbac3d3dc9c40793c8d84f09e1a9309604be8b2f22c147578040d82d7a5c4740f8620cfe47be3e3583e33f430f311248ad0ff5a2f9f10b1b7fb42b9277ed0bdd781a072e219d0ae44f221ebdf76f3950378736807f7ccdea564cbcd1ea9f4ed0b687557d5d47b7fa4607113883c711d5ef25309bff63f6117655da12305683aa6fbe9593e8276cc11d4b3e95dafe59fed5690308aa8456eba69ac2e429394230404d3e5791aa35890ebe49f248a4c6ed1ddfca16e9e4b926391fee6168b0a9ff14655bd424c50e1a6b1afb7e4bdb996870c1614f0b5d48aa1dfa660e94423392755a5af86b5e240abcb0fac0703c2444ad847366345590fa1bf3b9856dbc593c209973980a175af1993c474cb667a64725caf2944ab009ce8e5617d733f7f5ca236d38fa2cfeb472cc54e55c28bb70d8c94c293f6453527ba70e0864b1e7908529857e52a64cd150ef6c24d6791858d3322c852defa7e90faedf498351333f664325d5761c1a41c540a79b5efebbaeb527c25bc5cfdc4a3bce0c2dfbd7d642733a0d462b9028be481110063eee67e79447cc33afe08b857afba6c7304d206d5e00b7457249cb09fb1d022c93b315807b25961ee348e234e2101bb87ebd71fbc6a41a0e1ee86768369cba48f891f0adec9f240a0c05a", "2244cd35ce222646e8abb1e15ec0466f87c07ed4d00fa95d07a38a34aa61aae1", "7e7610a1628c19f6d53bfbaee6f92f59");
}